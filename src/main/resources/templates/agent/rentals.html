<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Kelola Rental - Dashboard Agent</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f5f5f5; }
        .header { background-color: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-menu { background-color: #34495e; padding: 1rem 2rem; }
        .nav-menu a { color: white; text-decoration: none; margin-right: 2rem; padding: 0.5rem 1rem; border-radius: 4px; transition: background-color 0.3s; }
        .nav-menu a:hover, .nav-menu a.active { background-color: #2c3e50; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .add-btn { background-color: #e74c3c; color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 4px; font-weight: bold; transition: background-color 0.3s; }
        .add-btn:hover { background-color: #c0392b; }
        .data-table { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { background-color: #34495e; color: white; padding: 1rem; text-align: left; font-weight: 600; }
        .table td { padding: 1rem; border-bottom: 1px solid #eee; vertical-align: middle; }
        .table tr:last-child td { border-bottom: none; }
        .table tr:hover { background-color: #f8f9fa; }
        .action-buttons { display: flex; gap: 0.5rem; }
        .btn { padding: 0.5rem 1rem; text-decoration: none; border-radius: 4px; font-size: 0.875rem; border: none; cursor: pointer; transition: background-color 0.3s; }
        .btn-edit { background-color: #27ae60; color: white; }
        .btn-edit:hover { background-color: #229954; }
        .btn-delete { background-color: #e74c3c; color: white; }
        .btn-delete:hover { background-color: #c0392b; }
        .status-badge { padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;}
        .status-ACTIVE { background-color: #d4edda; color: #155724; }
        .status-COMPLETED { background-color: #cce7ff; color: #004085; }
        .status-CANCELLED { background-color: #f8d7da; color: #721c24; }
        .status-PENDING { background-color: #fff3cd; color: #856404; }
        .status-OVERDUE { background-color: #f5c6cb; color: #721c24; }
        .alert { padding: 1rem; margin-bottom: 1rem; border-radius: 4px; font-weight: 500; border: 1px solid transparent; }
        .alert-success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .empty-state { text-align: center; padding: 3rem; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Dashboard Agent</h1>
        <a href="/logout" style="color: #ecf0f1; text-decoration: none;">Logout</a>
    </div>
    
    <div class="nav-menu">
        <a href="/agent/dashboard">Dashboard</a>
        <a href="/agent/cars">Kelola Mobil</a>
        <a href="/agent/rentals" class="active">Kelola Rental</a>
        <a href="/agent/clients">Kelola Client</a>
    </div>
    
    <div class="container">
        <div class="content-header">
            <h2>Daftar Transaksi Rental</h2>
            <a th:href="@{/agent/rentals/add}" class="add-btn">+ Tambah Rental Baru</a>
        </div>
        
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        
        <div class="data-table">
            <table class="table" th:if="${!#lists.isEmpty(rentals)}">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Client</th>
                        <th>Mobil</th>
                        <th>Periode Sewa</th>
                        <th>Biaya Sewa</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="rental : ${rentals}">
                        <td th:text="${rental.id}">1</td>
                        <!-- Menggabungkan nama depan dan belakang, serta NIK untuk identifikasi -->
                        <td th:text="${rental.client.namaDepan + ' ' + rental.client.namaBelakang + ' (' + rental.client.nik + ')'}">John Doe</td>
                        <td th:text="${rental.car.merek + ' ' + rental.car.model + ' (' + rental.car.platNomor + ')'}">Toyota Avanza</td>
                        <td th:text="${#temporals.format(rental.tanggalMulai, 'dd MMM yyyy')} + ' - ' + ${#temporals.format(rental.tanggalSelesai, 'dd MMM yyyy')}">01 Jan 2024 - 05 Jan 2024</td>
                        <!-- Memformat biaya sewa sebagai mata uang -->
                        <td th:text="'Rp ' + ${#numbers.formatDecimal(rental.biayaSewa, 0, 'POINT', 0, 'COMMA')}">Rp 1.500.000</td>
                        <td>
                            <!-- Menggunakan nama Enum untuk class dan displayName untuk teks -->
                            <span class="status-badge" th:classappend="'status-' + ${rental.statusPenyewaan.name()}" th:text="${rental.statusPenyewaan.displayName}">Aktif</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a th:href="@{/agent/rentals/edit/{id}(id=${rental.id})}" class="btn btn-edit">Edit</a>
                                <a th:href="@{/agent/rentals/delete/{id}(id=${rental.id})}" class="btn btn-delete" onclick="return confirm('Anda yakin ingin menghapus rental ini? Status mobil terkait akan dikembalikan menjadi TERSEDIA.')">Hapus</a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div th:if="${#lists.isEmpty(rentals)}" class="empty-state">
                <h3>Belum Ada Data Rental</h3>
                <p>Silakan tambahkan data rental baru untuk memulai.</p>
            </div>
        </div>
    </div>
</body>
</html>
